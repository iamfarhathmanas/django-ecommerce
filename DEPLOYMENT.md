# Deployment Guide for Render

This guide will help you deploy your Django E-Commerce application to Render.

## Prerequisites

- GitHub account
- Render account (sign up at https://render.com - it's free!)

## Step 1: Push Your Code to GitHub

Make sure your code is pushed to GitHub:

```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

## Step 2: Create a PostgreSQL Database on Render

1. Go to https://dashboard.render.com
2. Click **"New +"** → **"PostgreSQL"**
3. Configure:
   - **Name**: `django-ecommerce-db` (or your choice)
   - **Database**: `django_ecommerce` (or your choice)
   - **User**: Leave default
   - **Region**: Choose closest to you
   - **Plan**: **Free** (for testing)
4. Click **"Create Database"**
5. Wait for database to be ready (1-2 minutes)
6. **Copy the "Internal Database URL"** - you'll need this!

## Step 3: Create Web Service on Render

1. In Render dashboard, click **"New +"** → **"Web Service"**
2. Connect your GitHub account if not already connected
3. Select your repository: `django-ecommerce` (or your repo name)
4. Configure the service:

   **Basic Settings:**
   - **Name**: `django-ecommerce` (or your choice)
   - **Region**: Same as database
   - **Branch**: `main` (or `master`)
   - **Root Directory**: Leave empty (or `.` if needed)
   - **Runtime**: `Python 3`
   - **Build Command**: 
     ```
     chmod +x build.sh && ./build.sh
     ```
     (This automatically runs migrations, creates superuser, and seeds products)
   - **Start Command**: 
     ```
     gunicorn config.wsgi:application
     ```

5. Click **"Advanced"** and add Environment Variables:

   **Required Environment Variables:**
   ```
   DJANGO_SECRET_KEY=<generate-a-secure-random-key>
   DJANGO_DEBUG=False
   ALLOWED_HOSTS=your-app-name.onrender.com
   DATABASE_URL=<paste-internal-database-url-from-step-2>
   ```

   **For Auto Superuser Creation (Optional but Recommended):**
   ```
   ADMIN_USERNAME=admin
   ADMIN_EMAIL=your-email@example.com
   ADMIN_PASSWORD=YourSecurePassword123!
   ```

   **Optional (but recommended):**
   ```
   APP_NAME=Manas Shop
   REDIS_URL=<if-using-redis>
   STRIPE_SECRET_KEY=<your-stripe-key>
   STRIPE_PUBLIC_KEY=<your-stripe-key>
   RAZORPAY_KEY_ID=<your-razorpay-key>
   RAZORPAY_KEY_SECRET=<your-razorpay-secret>
   ```

6. Click **"Create Web Service"**

## Step 4: Automatic Setup (No Shell Needed!)

The build script automatically handles:
- ✅ Database migrations
- ✅ Superuser creation (if ADMIN_PASSWORD is set)
- ✅ Product seeding (50 products)

**No manual commands needed!** Everything runs during deployment.

**Note:** If you didn't set `ADMIN_PASSWORD`, you can still create a superuser later using Django admin or by setting the environment variable and redeploying.

## Step 5: Access Your Site

Your site will be live at:
```
https://your-app-name.onrender.com
```

## Important Notes

### Free Tier Limitations:
- **Sleeps after 15 minutes** of inactivity
- First request after sleep may take 30-60 seconds
- **750 hours/month** free (enough for testing)

### Media Files:
- For production, use **AWS S3** or **Cloudinary** for media storage
- Render's free tier doesn't persist media files between deployments
- Update `DEFAULT_FILE_STORAGE` in settings.py to use S3

### Environment Variables:
- Never commit `.env` files
- All secrets should be in Render's Environment Variables
- `DJANGO_SECRET_KEY` can be auto-generated by Render

### Database:
- PostgreSQL is included free with Render
- Database persists between deployments
- Use the **Internal Database URL** for connection

## Troubleshooting

### Build Fails:
- Check build logs in Render dashboard
- Ensure all dependencies are in `requirements.txt`
- Verify Python version in `runtime.txt`
- Make sure `build.sh` has execute permissions (the build command handles this)
- Check that `DATABASE_URL` is set correctly

### Static Files Not Loading:
- Ensure `collectstatic` runs in build command
- Check `STATIC_ROOT` and `STATIC_URL` in settings.py
- Verify WhiteNoise is installed and configured

### Database Connection Errors:
- Verify `DATABASE_URL` is set correctly
- Check database is running in Render dashboard
- Ensure `psycopg2-binary` is in requirements.txt

### 500 Errors:
- Check logs in Render dashboard
- Verify all environment variables are set
- Check `ALLOWED_HOSTS` includes your Render URL

## Next Steps

1. Set up custom domain (optional)
2. Configure email settings for production
3. Set up monitoring and alerts
4. Configure backup strategy
5. Set up CI/CD for automatic deployments

## Support

- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/stable/howto/deployment/

